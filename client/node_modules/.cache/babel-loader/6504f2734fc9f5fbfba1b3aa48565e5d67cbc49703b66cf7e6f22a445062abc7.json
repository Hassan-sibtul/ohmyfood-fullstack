{"ast":null,"code":"// server/routes/recommendations.js\nconst express = require(\"express\");\nconst router = express.Router();\nconst Order = require(\"../models/Order\");\nconst Restaurant = require(\"../models/Restaurant\");\nconst auth = require(\"../middleware/auth\");\n\n// ‚úÖ GET /api/recommendations/:restaurantId\nrouter.get(\"/:restaurantId\", auth, async (req, res) => {\n  try {\n    const {\n      restaurantId\n    } = req.params;\n\n    // Get all user past orders\n    const pastOrders = await Order.find({\n      user: req.user.id\n    }).lean();\n    if (!pastOrders.length) {\n      return res.json([]); // üëà no fake recommendations if no history\n    }\n\n    // Flatten all items from user‚Äôs past orders\n    const allItems = pastOrders.flatMap(o => o.items || []);\n\n    // Count how many times each item was ordered\n    const frequency = {};\n    allItems.forEach(item => {\n      const key = item.name.toLowerCase();\n      frequency[key] = (frequency[key] || 0) + 1;\n    });\n\n    // Find top 2 most ordered item names\n    const topItems = Object.entries(frequency).sort((a, b) => b[1] - a[1]).slice(0, 2).map(([name]) => name);\n\n    // Get restaurant menu\n    const restaurant = await Restaurant.findById(restaurantId).lean();\n    if (!(restaurant !== null && restaurant !== void 0 && restaurant.menu)) return res.json([]);\n\n    // Filter recommendations\n    const recommendations = restaurant.menu.filter(menuItem => {\n      const lowerName = menuItem.name.toLowerCase();\n      // Include items with similar category or similar name keywords\n      return topItems.some(fav => lowerName.includes(fav.split(\" \")[0]) || menuItem.category && fav.split(\" \").some(word => menuItem.category.toLowerCase().includes(word)));\n    });\n\n    // Exclude items already ordered a lot\n    const filtered = recommendations.filter(r => !topItems.includes(r.name.toLowerCase()));\n\n    // Limit to top 3 recommendations\n    res.json(filtered.slice(0, 3));\n  } catch (err) {\n    console.error(\"‚ùå Recommendation error:\", err);\n    res.status(500).json({\n      error: \"Failed to load recommendations\"\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","router","Router","Order","Restaurant","auth","get","req","res","restaurantId","params","pastOrders","find","user","id","lean","length","json","allItems","flatMap","o","items","frequency","forEach","item","key","name","toLowerCase","topItems","Object","entries","sort","a","b","slice","map","restaurant","findById","menu","recommendations","filter","menuItem","lowerName","some","fav","includes","split","category","word","filtered","r","err","console","error","status","module","exports"],"sources":["/Users/sibtulhassan/Downloads/ohmyfood-fullstack/client/src/components/Recommendations.js"],"sourcesContent":["// server/routes/recommendations.js\nconst express = require(\"express\");\nconst router = express.Router();\nconst Order = require(\"../models/Order\");\nconst Restaurant = require(\"../models/Restaurant\");\nconst auth = require(\"../middleware/auth\");\n\n// ‚úÖ GET /api/recommendations/:restaurantId\nrouter.get(\"/:restaurantId\", auth, async (req, res) => {\n  try {\n    const { restaurantId } = req.params;\n\n    // Get all user past orders\n    const pastOrders = await Order.find({ user: req.user.id }).lean();\n\n    if (!pastOrders.length) {\n      return res.json([]); // üëà no fake recommendations if no history\n    }\n\n    // Flatten all items from user‚Äôs past orders\n    const allItems = pastOrders.flatMap((o) => o.items || []);\n\n    // Count how many times each item was ordered\n    const frequency = {};\n    allItems.forEach((item) => {\n      const key = item.name.toLowerCase();\n      frequency[key] = (frequency[key] || 0) + 1;\n    });\n\n    // Find top 2 most ordered item names\n    const topItems = Object.entries(frequency)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 2)\n      .map(([name]) => name);\n\n    // Get restaurant menu\n    const restaurant = await Restaurant.findById(restaurantId).lean();\n    if (!restaurant?.menu) return res.json([]);\n\n    // Filter recommendations\n    const recommendations = restaurant.menu.filter((menuItem) => {\n      const lowerName = menuItem.name.toLowerCase();\n      // Include items with similar category or similar name keywords\n      return topItems.some(\n        (fav) =>\n          lowerName.includes(fav.split(\" \")[0]) ||\n          (menuItem.category &&\n            fav\n              .split(\" \")\n              .some((word) => menuItem.category.toLowerCase().includes(word)))\n      );\n    });\n\n    // Exclude items already ordered a lot\n    const filtered = recommendations.filter(\n      (r) => !topItems.includes(r.name.toLowerCase())\n    );\n\n    // Limit to top 3 recommendations\n    res.json(filtered.slice(0, 3));\n  } catch (err) {\n    console.error(\"‚ùå Recommendation error:\", err);\n    res.status(500).json({ error: \"Failed to load recommendations\" });\n  }\n});\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}